var i = this; !function () { var e = function () { this.init = function () { var e = {}; this.on = function (t, i) { e[t] || (e[t] = []), e[t] = e[t].concat(i) }, this.off = function (t, i) { var n; return !!e[t] && (n = e[t].indexOf(i), e[t] = e[t].slice(), e[t].splice(n, 1), n > -1) }, this.trigger = function (t) { var i, n, r, s; if (i = e[t]) if (2 === arguments.length) for (r = i.length, n = 0; n < r; ++n)i[n].call(this, arguments[1]); else { for (s = [], n = arguments.length, n = 1; n < arguments.length; ++n)s.push(arguments[n]); for (r = i.length, n = 0; n < r; ++n)i[n].apply(this, s) } }, this.dispose = function () { e = {} } } }; e.prototype.pipe = function (e) { return this.on("data", (function (t) { e.push(t) })), this.on("done", (function (t) { e.flush(t) })), this.on("partialdone", (function (t) { e.partialFlush(t) })), this.on("endedtimeline", (function (t) { e.endTimeline(t) })), this.on("reset", (function (t) { e.reset(t) })), e }, e.prototype.push = function (e) { this.trigger("data", e) }, e.prototype.flush = function (e) { this.trigger("done", e) }, e.prototype.partialFlush = function (e) { this.trigger("partialdone", e) }, e.prototype.endTimeline = function (e) { this.trigger("endedtimeline", e) }, e.prototype.reset = function (e) { this.trigger("reset", e) }; var t, n, r, s, a, o, l, u, c, d, h, p, f, m, g, v, y, _, b, T, S, k, C, E, w, A, P, L, I, x, D, O, R, M, N, U, B, j, F, H, V = e, q = Math.pow(2, 32) - 1; !function () { var e; if (k = { avc1: [], avcC: [], btrt: [], dinf: [], dref: [], esds: [], ftyp: [], hdlr: [], mdat: [], mdhd: [], mdia: [], mfhd: [], minf: [], moof: [], moov: [], mp4a: [], mvex: [], mvhd: [], pasp: [], sdtp: [], smhd: [], stbl: [], stco: [], stsc: [], stsd: [], stsz: [], stts: [], styp: [], tfdt: [], tfhd: [], traf: [], trak: [], trun: [], trex: [], tkhd: [], vmhd: [] }, "undefined" != typeof Uint8Array) { for (e in k) k.hasOwnProperty(e) && (k[e] = [e.charCodeAt(0), e.charCodeAt(1), e.charCodeAt(2), e.charCodeAt(3)]); C = new Uint8Array(["i".charCodeAt(0), "s".charCodeAt(0), "o".charCodeAt(0), "m".charCodeAt(0)]), w = new Uint8Array(["a".charCodeAt(0), "v".charCodeAt(0), "c".charCodeAt(0), "1".charCodeAt(0)]), E = new Uint8Array([0, 0, 0, 1]), A = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 118, 105, 100, 101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 105, 100, 101, 111, 72, 97, 110, 100, 108, 101, 114, 0]), P = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 115, 111, 117, 110, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 83, 111, 117, 110, 100, 72, 97, 110, 100, 108, 101, 114, 0]), L = { video: A, audio: P }, D = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 12, 117, 114, 108, 32, 0, 0, 0, 1]), x = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), O = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), R = O, M = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]), N = O, I = new Uint8Array([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]) } }(), t = function (e) { var t, i, n = [], r = 0; for (t = 1; t < arguments.length; t++)n.push(arguments[t]); for (t = n.length; t--;)r += n[t].byteLength; for (i = new Uint8Array(r + 8), new DataView(i.buffer, i.byteOffset, i.byteLength).setUint32(0, i.byteLength), i.set(e, 4), t = 0, r = 8; t < n.length; t++)i.set(n[t], r), r += n[t].byteLength; return i }, n = function () { return t(k.dinf, t(k.dref, D)) }, r = function (e) { return t(k.esds, new Uint8Array([0, 0, 0, 0, 3, 25, 0, 0, 0, 4, 17, 64, 21, 0, 6, 0, 0, 0, 218, 192, 0, 0, 218, 192, 5, 2, e.audioobjecttype << 3 | e.samplingfrequencyindex >>> 1, e.samplingfrequencyindex << 7 | e.channelcount << 3, 6, 1, 2])) }, g = function (e) { return t(k.hdlr, L[e]) }, m = function (e) { var i = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 3, 0, 1, 95, 144, e.duration >>> 24 & 255, e.duration >>> 16 & 255, e.duration >>> 8 & 255, 255 & e.duration, 85, 196, 0, 0]); return e.samplerate && (i[12] = e.samplerate >>> 24 & 255, i[13] = e.samplerate >>> 16 & 255, i[14] = e.samplerate >>> 8 & 255, i[15] = 255 & e.samplerate), t(k.mdhd, i) }, f = function (e) { return t(k.mdia, m(e), g(e.type), o(e)) }, a = function (e) { return t(k.mfhd, new Uint8Array([0, 0, 0, 0, (4278190080 & e) >> 24, (16711680 & e) >> 16, (65280 & e) >> 8, 255 & e])) }, o = function (e) { return t(k.minf, "video" === e.type ? t(k.vmhd, I) : t(k.smhd, x), n(), y(e)) }, l = function (e, i) { for (var n = [], r = i.length; r--;)n[r] = b(i[r]); return t.apply(null, [k.moof, a(e)].concat(n)) }, u = function (e) { for (var i = e.length, n = []; i--;)n[i] = h(e[i]); return t.apply(null, [k.moov, d(4294967295)].concat(n).concat(c(e))) }, c = function (e) { for (var i = e.length, n = []; i--;)n[i] = T(e[i]); return t.apply(null, [k.mvex].concat(n)) }, d = function (e) { var i = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 1, 95, 144, (4278190080 & e) >> 24, (16711680 & e) >> 16, (65280 & e) >> 8, 255 & e, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255]); return t(k.mvhd, i) }, v = function (e) { var i, n, r = e.samples || [], s = new Uint8Array(4 + r.length); for (n = 0; n < r.length; n++)i = r[n].flags, s[n + 4] = i.dependsOn << 4 | i.isDependedOn << 2 | i.hasRedundancy; return t(k.sdtp, s) }, y = function (e) { return t(k.stbl, _(e), t(k.stts, N), t(k.stsc, R), t(k.stsz, M), t(k.stco, O)) }, _ = function (e) { return t(k.stsd, new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1]), "video" === e.type ? U(e) : B(e)) }, U = function (e) { var i, n, r = e.sps || [], s = e.pps || [], a = [], o = []; for (i = 0; i < r.length; i++)a.push((65280 & r[i].byteLength) >>> 8), a.push(255 & r[i].byteLength), a = a.concat(Array.prototype.slice.call(r[i])); for (i = 0; i < s.length; i++)o.push((65280 & s[i].byteLength) >>> 8), o.push(255 & s[i].byteLength), o = o.concat(Array.prototype.slice.call(s[i])); if (n = [k.avc1, new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (65280 & e.width) >> 8, 255 & e.width, (65280 & e.height) >> 8, 255 & e.height, 0, 72, 0, 0, 0, 72, 0, 0, 0, 0, 0, 0, 0, 1, 19, 118, 105, 100, 101, 111, 106, 115, 45, 99, 111, 110, 116, 114, 105, 98, 45, 104, 108, 115, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 17, 17]), t(k.avcC, new Uint8Array([1, e.profileIdc, e.profileCompatibility, e.levelIdc, 255].concat([r.length], a, [s.length], o))), t(k.btrt, new Uint8Array([0, 28, 156, 128, 0, 45, 198, 192, 0, 45, 198, 192]))], e.sarRatio) { var l = e.sarRatio[0], u = e.sarRatio[1]; n.push(t(k.pasp, new Uint8Array([(4278190080 & l) >> 24, (16711680 & l) >> 16, (65280 & l) >> 8, 255 & l, (4278190080 & u) >> 24, (16711680 & u) >> 16, (65280 & u) >> 8, 255 & u]))) } return t.apply(null, n) }, B = function (e) { return t(k.mp4a, new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, (65280 & e.channelcount) >> 8, 255 & e.channelcount, (65280 & e.samplesize) >> 8, 255 & e.samplesize, 0, 0, 0, 0, (65280 & e.samplerate) >> 8, 255 & e.samplerate, 0, 0]), r(e)) }, p = function (e) { var i = new Uint8Array([0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, (4278190080 & e.id) >> 24, (16711680 & e.id) >> 16, (65280 & e.id) >> 8, 255 & e.id, 0, 0, 0, 0, (4278190080 & e.duration) >> 24, (16711680 & e.duration) >> 16, (65280 & e.duration) >> 8, 255 & e.duration, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, (65280 & e.width) >> 8, 255 & e.width, 0, 0, (65280 & e.height) >> 8, 255 & e.height, 0, 0]); return t(k.tkhd, i) }, b = function (e) { var i, n, r, s, a, o; return i = t(k.tfhd, new Uint8Array([0, 0, 0, 58, (4278190080 & e.id) >> 24, (16711680 & e.id) >> 16, (65280 & e.id) >> 8, 255 & e.id, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])), a = Math.floor(e.baseMediaDecodeTime / (q + 1)), o = Math.floor(e.baseMediaDecodeTime % (q + 1)), n = t(k.tfdt, new Uint8Array([1, 0, 0, 0, a >>> 24 & 255, a >>> 16 & 255, a >>> 8 & 255, 255 & a, o >>> 24 & 255, o >>> 16 & 255, o >>> 8 & 255, 255 & o])), "audio" === e.type ? (r = S(e, 92), t(k.traf, i, n, r)) : (s = v(e), r = S(e, s.length + 92), t(k.traf, i, n, r, s)) }, h = function (e) { return e.duration = e.duration || 4294967295, t(k.trak, p(e), f(e)) }, T = function (e) { var i = new Uint8Array([0, 0, 0, 0, (4278190080 & e.id) >> 24, (16711680 & e.id) >> 16, (65280 & e.id) >> 8, 255 & e.id, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1]); return "video" !== e.type && (i[i.length - 1] = 0), t(k.trex, i) }, H = function (e, t) { var i = 0, n = 0, r = 0, s = 0; return e.length && (void 0 !== e[0].duration && (i = 1), void 0 !== e[0].size && (n = 2), void 0 !== e[0].flags && (r = 4), void 0 !== e[0].compositionTimeOffset && (s = 8)), [0, 0, i | n | r | s, 1, (4278190080 & e.length) >>> 24, (16711680 & e.length) >>> 16, (65280 & e.length) >>> 8, 255 & e.length, (4278190080 & t) >>> 24, (16711680 & t) >>> 16, (65280 & t) >>> 8, 255 & t] }, F = function (e, i) { var n, r, s, a, o, l; for (i += 20 + 16 * (a = e.samples || []).length, s = H(a, i), (r = new Uint8Array(s.length + 16 * a.length)).set(s), n = s.length, l = 0; l < a.length; l++)o = a[l], r[n++] = (4278190080 & o.duration) >>> 24, r[n++] = (16711680 & o.duration) >>> 16, r[n++] = (65280 & o.duration) >>> 8, r[n++] = 255 & o.duration, r[n++] = (4278190080 & o.size) >>> 24, r[n++] = (16711680 & o.size) >>> 16, r[n++] = (65280 & o.size) >>> 8, r[n++] = 255 & o.size, r[n++] = o.flags.isLeading << 2 | o.flags.dependsOn, r[n++] = o.flags.isDependedOn << 6 | o.flags.hasRedundancy << 4 | o.flags.paddingValue << 1 | o.flags.isNonSyncSample, r[n++] = 61440 & o.flags.degradationPriority, r[n++] = 15 & o.flags.degradationPriority, r[n++] = (4278190080 & o.compositionTimeOffset) >>> 24, r[n++] = (16711680 & o.compositionTimeOffset) >>> 16, r[n++] = (65280 & o.compositionTimeOffset) >>> 8, r[n++] = 255 & o.compositionTimeOffset; return t(k.trun, r) }, j = function (e, i) { var n, r, s, a, o, l; for (i += 20 + 8 * (a = e.samples || []).length, s = H(a, i), (n = new Uint8Array(s.length + 8 * a.length)).set(s), r = s.length, l = 0; l < a.length; l++)o = a[l], n[r++] = (4278190080 & o.duration) >>> 24, n[r++] = (16711680 & o.duration) >>> 16, n[r++] = (65280 & o.duration) >>> 8, n[r++] = 255 & o.duration, n[r++] = (4278190080 & o.size) >>> 24, n[r++] = (16711680 & o.size) >>> 16, n[r++] = (65280 & o.size) >>> 8, n[r++] = 255 & o.size; return t(k.trun, n) }, S = function (e, t) { return "audio" === e.type ? j(e, t) : F(e, t) }, s = function () { return t(k.ftyp, C, E, C, w) }; var W, z, G, X, K, Y, $, Q, J = function (e) { return t(k.mdat, e) }, Z = l, ee = function (e, t) { var i = { size: 0, flags: { isLeading: 0, dependsOn: 1, isDependedOn: 0, hasRedundancy: 0, degradationPriority: 0, isNonSyncSample: 1 } }; return i.dataOffset = t, i.compositionTimeOffset = e.pts - e.dts, i.duration = e.duration, i.size = 4 * e.length, i.size += e.byteLength, e.keyFrame && (i.flags.dependsOn = 2, i.flags.isNonSyncSample = 0), i }, te = [33, 16, 5, 32, 164, 27], ie = [33, 65, 108, 84, 1, 2, 4, 8, 168, 2, 4, 8, 17, 191, 252], ne = function (e) { for (var t = []; e--;)t.push(0); return t }, re = 9e4; Y = function (e, t) { return z(K(e, t)) }, $ = function (e, t) { return G(X(e), t) }, Q = function (e, t, i) { return X(i ? e : e - t) }; var se = re, ae = (z = function (e) { return e * re }, G = function (e, t) { return e * t }, X = function (e) { return e / re }, K = function (e, t) { return e / t }, Y), oe = $, le = Q, ue = function (e, t, i, n) { var r, s, a, o, l, u = 0, c = 0, d = 0; if (t.length && (r = ae(e.baseMediaDecodeTime, e.samplerate), s = Math.ceil(se / (e.samplerate / 1024)), i && n && (u = r - Math.max(i, n), d = (c = Math.floor(u / s)) * s), !(c < 1 || d > 45e3))) { for ((a = function () { if (!W) { var e = { 96e3: [te, [227, 64], ne(154), [56]], 88200: [te, [231], ne(170), [56]], 64e3: [te, [248, 192], ne(240), [56]], 48e3: [te, [255, 192], ne(268), [55, 148, 128], ne(54), [112]], 44100: [te, [255, 192], ne(268), [55, 163, 128], ne(84), [112]], 32e3: [te, [255, 192], ne(268), [55, 234], ne(226), [112]], 24e3: [te, [255, 192], ne(268), [55, 255, 128], ne(268), [111, 112], ne(126), [224]], 16e3: [te, [255, 192], ne(268), [55, 255, 128], ne(268), [111, 255], ne(269), [223, 108], ne(195), [1, 192]], 12e3: [ie, ne(268), [3, 127, 248], ne(268), [6, 255, 240], ne(268), [13, 255, 224], ne(268), [27, 253, 128], ne(259), [56]], 11025: [ie, ne(268), [3, 127, 248], ne(268), [6, 255, 240], ne(268), [13, 255, 224], ne(268), [27, 255, 192], ne(268), [55, 175, 128], ne(108), [112]], 8e3: [ie, ne(268), [3, 121, 16], ne(47), [7]] }; t = e, W = Object.keys(t).reduce((function (e, i) { return e[i] = new Uint8Array(t[i].reduce((function (e, t) { return e.concat(t) }), [])), e }), {}) } var t; return W }()[e.samplerate]) || (a = t[0].data), o = 0; o < c; o++)l = t[0], t.splice(0, 0, { data: a, dts: l.dts - s, pts: l.pts - s }); e.baseMediaDecodeTime -= Math.floor(oe(d, e.samplerate)) } }, ce = function (e) { delete e.minSegmentDts, delete e.maxSegmentDts, delete e.minSegmentPts, delete e.maxSegmentPts }, de = function (e, t) { var i, n = e.minSegmentDts; return t || (n -= e.timelineStartInfo.dts), i = e.timelineStartInfo.baseMediaDecodeTime, i += n, i = Math.max(0, i), "audio" === e.type && (i *= e.samplerate / 9e4, i = Math.floor(i)), i }, he = function (e, t) { "number" == typeof t.pts && (void 0 === e.timelineStartInfo.pts && (e.timelineStartInfo.pts = t.pts), void 0 === e.minSegmentPts ? e.minSegmentPts = t.pts : e.minSegmentPts = Math.min(e.minSegmentPts, t.pts), void 0 === e.maxSegmentPts ? e.maxSegmentPts = t.pts : e.maxSegmentPts = Math.max(e.maxSegmentPts, t.pts)), "number" == typeof t.dts && (void 0 === e.timelineStartInfo.dts && (e.timelineStartInfo.dts = t.dts), void 0 === e.minSegmentDts ? e.minSegmentDts = t.dts : e.minSegmentDts = Math.min(e.minSegmentDts, t.dts), void 0 === e.maxSegmentDts ? e.maxSegmentDts = t.dts : e.maxSegmentDts = Math.max(e.maxSegmentDts, t.dts)) }, pe = function e() { e.prototype.init.call(this), this.captionPackets_ = [], this.ccStreams_ = [new ye(0, 0), new ye(0, 1), new ye(1, 0), new ye(1, 1)], this.reset(), this.ccStreams_.forEach((function (e) { e.on("data", this.trigger.bind(this, "data")), e.on("partialdone", this.trigger.bind(this, "partialdone")), e.on("done", this.trigger.bind(this, "done")) }), this) }; (pe.prototype = new V).push = function (e) { var t, i, n; if ("sei_rbsp" === e.nalUnitType && 4 === (t = function (e) { for (var t = 0, i = { payloadType: -1, payloadSize: 0 }, n = 0, r = 0; t < e.byteLength && 128 !== e[t];) { for (; 255 === e[t];)n += 255, t++; for (n += e[t++]; 255 === e[t];)r += 255, t++; if (r += e[t++], !i.payload && 4 === n) { i.payloadType = n, i.payloadSize = r, i.payload = e.subarray(t, t + r); break } t += r, n = 0, r = 0 } return i }(e.escapedRBSP)).payloadType && (i = function (e) { return 181 !== e.payload[0] || 49 != (e.payload[1] << 8 | e.payload[2]) || "GA94" !== String.fromCharCode(e.payload[3], e.payload[4], e.payload[5], e.payload[6]) || 3 !== e.payload[7] ? null : e.payload.subarray(8, e.payload.length - 1) }(t))) if (e.dts < this.latestDts_) this.ignoreNextEqualDts_ = !0; else { if (e.dts === this.latestDts_ && this.ignoreNextEqualDts_) return this.numSameDts_--, void (this.numSameDts_ || (this.ignoreNextEqualDts_ = !1)); n = function (e, t) { var i, n, r, s, a = []; if (!(64 & t[0])) return a; for (n = 31 & t[0], i = 0; i < n; i++)s = { type: 3 & t[2 + (r = 3 * i)], pts: e }, 4 & t[r + 2] && (s.ccData = t[r + 3] << 8 | t[r + 4], a.push(s)); return a }(e.pts, i), this.captionPackets_ = this.captionPackets_.concat(n), this.latestDts_ !== e.dts && (this.numSameDts_ = 0), this.numSameDts_++, this.latestDts_ = e.dts } }, pe.prototype.flushCCStreams = function (e) { this.ccStreams_.forEach((function (t) { return "flush" === e ? t.flush() : t.partialFlush() }), this) }, pe.prototype.flushStream = function (e) { this.captionPackets_.length ? (this.captionPackets_.forEach((function (e, t) { e.presortIndex = t })), this.captionPackets_.sort((function (e, t) { return e.pts === t.pts ? e.presortIndex - t.presortIndex : e.pts - t.pts })), this.captionPackets_.forEach((function (e) { e.type < 2 && this.dispatchCea608Packet(e) }), this), this.captionPackets_.length = 0, this.flushCCStreams(e)) : this.flushCCStreams(e) }, pe.prototype.flush = function () { return this.flushStream("flush") }, pe.prototype.partialFlush = function () { return this.flushStream("partialFlush") }, pe.prototype.reset = function () { this.latestDts_ = null, this.ignoreNextEqualDts_ = !1, this.numSameDts_ = 0, this.activeCea608Channel_ = [null, null], this.ccStreams_.forEach((function (e) { e.reset() })) }, pe.prototype.dispatchCea608Packet = function (e) { this.setsTextOrXDSActive(e) ? this.activeCea608Channel_[e.type] = null : this.setsChannel1Active(e) ? this.activeCea608Channel_[e.type] = 0 : this.setsChannel2Active(e) && (this.activeCea608Channel_[e.type] = 1), null !== this.activeCea608Channel_[e.type] && this.ccStreams_[(e.type << 1) + this.activeCea608Channel_[e.type]].push(e) }, pe.prototype.setsChannel1Active = function (e) { return 4096 == (30720 & e.ccData) }, pe.prototype.setsChannel2Active = function (e) { return 6144 == (30720 & e.ccData) }, pe.prototype.setsTextOrXDSActive = function (e) { return 256 == (28928 & e.ccData) || 4138 == (30974 & e.ccData) || 6186 == (30974 & e.ccData) }; var fe = { 42: 225, 92: 233, 94: 237, 95: 243, 96: 250, 123: 231, 124: 247, 125: 209, 126: 241, 127: 9608, 304: 174, 305: 176, 306: 189, 307: 191, 308: 8482, 309: 162, 310: 163, 311: 9834, 312: 224, 313: 160, 314: 232, 315: 226, 316: 234, 317: 238, 318: 244, 319: 251, 544: 193, 545: 201, 546: 211, 547: 218, 548: 220, 549: 252, 550: 8216, 551: 161, 552: 42, 553: 39, 554: 8212, 555: 169, 556: 8480, 557: 8226, 558: 8220, 559: 8221, 560: 192, 561: 194, 562: 199, 563: 200, 564: 202, 565: 203, 566: 235, 567: 206, 568: 207, 569: 239, 570: 212, 571: 217, 572: 249, 573: 219, 574: 171, 575: 187, 800: 195, 801: 227, 802: 205, 803: 204, 804: 236, 805: 210, 806: 242, 807: 213, 808: 245, 809: 123, 810: 125, 811: 92, 812: 94, 813: 95, 814: 124, 815: 126, 816: 196, 817: 228, 818: 214, 819: 246, 820: 223, 821: 165, 822: 164, 823: 9474, 824: 197, 825: 229, 826: 216, 827: 248, 828: 9484, 829: 9488, 830: 9492, 831: 9496 }, me = function (e) { return null === e ? "" : (e = fe[e] || e, String.fromCharCode(e)) }, ge = [4352, 4384, 4608, 4640, 5376, 5408, 5632, 5664, 5888, 5920, 4096, 4864, 4896, 5120, 5152], ve = function () { for (var e = [], t = 15; t--;)e.push(""); return e }, ye = function e(t, i) { e.prototype.init.call(this), this.field_ = t || 0, this.dataChannel_ = i || 0, this.name_ = "CC" + (1 + (this.field_ << 1 | this.dataChannel_)), this.setConstants(), this.reset(), this.push = function (e) { var t, i, n, r, s; if ((t = 32639 & e.ccData) !== this.lastControlCode_) { if (4096 == (61440 & t) ? this.lastControlCode_ = t : t !== this.PADDING_ && (this.lastControlCode_ = null), n = t >>> 8, r = 255 & t, t !== this.PADDING_) if (t === this.RESUME_CAPTION_LOADING_) this.mode_ = "popOn"; else if (t === this.END_OF_CAPTION_) this.mode_ = "popOn", this.clearFormatting(e.pts), this.flushDisplayed(e.pts), i = this.displayed_, this.displayed_ = this.nonDisplayed_, this.nonDisplayed_ = i, this.startPts_ = e.pts; else if (t === this.ROLL_UP_2_ROWS_) this.rollUpRows_ = 2, this.setRollUp(e.pts); else if (t === this.ROLL_UP_3_ROWS_) this.rollUpRows_ = 3, this.setRollUp(e.pts); else if (t === this.ROLL_UP_4_ROWS_) this.rollUpRows_ = 4, this.setRollUp(e.pts); else if (t === this.CARRIAGE_RETURN_) this.clearFormatting(e.pts), this.flushDisplayed(e.pts), this.shiftRowsUp_(), this.startPts_ = e.pts; else if (t === this.BACKSPACE_) "popOn" === this.mode_ ? this.nonDisplayed_[this.row_] = this.nonDisplayed_[this.row_].slice(0, -1) : this.displayed_[this.row_] = this.displayed_[this.row_].slice(0, -1); else if (t === this.ERASE_DISPLAYED_MEMORY_) this.flushDisplayed(e.pts), this.displayed_ = ve(); else if (t === this.ERASE_NON_DISPLAYED_MEMORY_) this.nonDisplayed_ = ve(); else if (t === this.RESUME_DIRECT_CAPTIONING_) "paintOn" !== this.mode_ && (this.flushDisplayed(e.pts), this.displayed_ = ve()), this.mode_ = "paintOn", this.startPts_ = e.pts; else if (this.isSpecialCharacter(n, r)) s = me((n = (3 & n) << 8) | r), this[this.mode_](e.pts, s), this.column_++; else if (this.isExtCharacter(n, r)) "popOn" === this.mode_ ? this.nonDisplayed_[this.row_] = this.nonDisplayed_[this.row_].slice(0, -1) : this.displayed_[this.row_] = this.displayed_[this.row_].slice(0, -1), s = me((n = (3 & n) << 8) | r), this[this.mode_](e.pts, s), this.column_++; else if (this.isMidRowCode(n, r)) this.clearFormatting(e.pts), this[this.mode_](e.pts, " "), this.column_++, 14 == (14 & r) && this.addFormatting(e.pts, ["i"]), 1 == (1 & r) && this.addFormatting(e.pts, ["u"]); else if (this.isOffsetControlCode(n, r)) this.column_ += 3 & r; else if (this.isPAC(n, r)) { var a = ge.indexOf(7968 & t); "rollUp" === this.mode_ && (a - this.rollUpRows_ + 1 < 0 && (a = this.rollUpRows_ - 1), this.setRollUp(e.pts, a)), a !== this.row_ && (this.clearFormatting(e.pts), this.row_ = a), 1 & r && -1 === this.formatting_.indexOf("u") && this.addFormatting(e.pts, ["u"]), 16 == (16 & t) && (this.column_ = 4 * ((14 & t) >> 1)), this.isColorPAC(r) && 14 == (14 & r) && this.addFormatting(e.pts, ["i"]) } else this.isNormalChar(n) && (0 === r && (r = null), s = me(n), s += me(r), this[this.mode_](e.pts, s), this.column_ += s.length) } else this.lastControlCode_ = null } }; ye.prototype = new V, ye.prototype.flushDisplayed = function (e) { var t = this.displayed_.map((function (e) { try { return e.trim() } catch (e) { return console.error("Skipping malformed caption."), "" } })).join("\n").replace(/^\n+|\n+$/g, ""); t.length && this.trigger("data", { startPts: this.startPts_, endPts: e, text: t, stream: this.name_ }) }, ye.prototype.reset = function () { this.mode_ = "popOn", this.topRow_ = 0, this.startPts_ = 0, this.displayed_ = ve(), this.nonDisplayed_ = ve(), this.lastControlCode_ = null, this.column_ = 0, this.row_ = 14, this.rollUpRows_ = 2, this.formatting_ = [] }, ye.prototype.setConstants = function () { 0 === this.dataChannel_ ? (this.BASE_ = 16, this.EXT_ = 17, this.CONTROL_ = (20 | this.field_) << 8, this.OFFSET_ = 23) : 1 === this.dataChannel_ && (this.BASE_ = 24, this.EXT_ = 25, this.CONTROL_ = (28 | this.field_) << 8, this.OFFSET_ = 31), this.PADDING_ = 0, this.RESUME_CAPTION_LOADING_ = 32 | this.CONTROL_, this.END_OF_CAPTION_ = 47 | this.CONTROL_, this.ROLL_UP_2_ROWS_ = 37 | this.CONTROL_, this.ROLL_UP_3_ROWS_ = 38 | this.CONTROL_, this.ROLL_UP_4_ROWS_ = 39 | this.CONTROL_, this.CARRIAGE_RETURN_ = 45 | this.CONTROL_, this.RESUME_DIRECT_CAPTIONING_ = 41 | this.CONTROL_, this.BACKSPACE_ = 33 | this.CONTROL_, this.ERASE_DISPLAYED_MEMORY_ = 44 | this.CONTROL_, this.ERASE_NON_DISPLAYED_MEMORY_ = 46 | this.CONTROL_ }, ye.prototype.isSpecialCharacter = function (e, t) { return e === this.EXT_ && t >= 48 && t <= 63 }, ye.prototype.isExtCharacter = function (e, t) { return (e === this.EXT_ + 1 || e === this.EXT_ + 2) && t >= 32 && t <= 63 }, ye.prototype.isMidRowCode = function (e, t) { return e === this.EXT_ && t >= 32 && t <= 47 }, ye.prototype.isOffsetControlCode = function (e, t) { return e === this.OFFSET_ && t >= 33 && t <= 35 }, ye.prototype.isPAC = function (e, t) { return e >= this.BASE_ && e < this.BASE_ + 8 && t >= 64 && t <= 127 }, ye.prototype.isColorPAC = function (e) { return e >= 64 && e <= 79 || e >= 96 && e <= 127 }, ye.prototype.isNormalChar = function (e) { return e >= 32 && e <= 127 }, ye.prototype.setRollUp = function (e, t) { if ("rollUp" !== this.mode_ && (this.row_ = 14, this.mode_ = "rollUp", this.flushDisplayed(e), this.nonDisplayed_ = ve(), this.displayed_ = ve()), void 0 !== t && t !== this.row_) for (var i = 0; i < this.rollUpRows_; i++)this.displayed_[t - i] = this.displayed_[this.row_ - i], this.displayed_[this.row_ - i] = ""; void 0 === t && (t = this.row_), this.topRow_ = t - this.rollUpRows_ + 1 }, ye.prototype.addFormatting = function (e, t) { this.formatting_ = this.formatting_.concat(t); var i = t.reduce((function (e, t) { return e + "<" + t + ">" }), ""); this[this.mode_](e, i) }, ye.prototype.clearFormatting = function (e) { if (this.formatting_.length) { var t = this.formatting_.reverse().reduce((function (e, t) { return e + "</" + t + ">" }), ""); this.formatting_ = [], this[this.mode_](e, t) } }, ye.prototype.popOn = function (e, t) { var i = this.nonDisplayed_[this.row_]; i += t, this.nonDisplayed_[this.row_] = i }, ye.prototype.rollUp = function (e, t) { var i = this.displayed_[this.row_]; i += t, this.displayed_[this.row_] = i }, ye.prototype.shiftRowsUp_ = function () { var e; for (e = 0; e < this.topRow_; e++)this.displayed_[e] = ""; for (e = this.row_ + 1; e < 15; e++)this.displayed_[e] = ""; for (e = this.topRow_; e < this.row_; e++)this.displayed_[e] = this.displayed_[e + 1]; this.displayed_[this.row_] = "" }, ye.prototype.paintOn = function (e, t) { var i = this.displayed_[this.row_]; i += t, this.displayed_[this.row_] = i }; var _e = { CaptionStream: pe, Cea608Stream: ye }, be = { H264_STREAM_TYPE: 27, ADTS_STREAM_TYPE: 15, METADATA_STREAM_TYPE: 21 }, Te = "shared", Se = function (e, t) { var i = 1; for (e > t && (i = -1); Math.abs(t - e) > 4294967296;)e += 8589934592 * i; return e }, ke = function e(t) { var i, n; e.prototype.init.call(this), this.type_ = t || Te, this.push = function (e) { this.type_ !== Te && e.type !== this.type_ || (void 0 === n && (n = e.dts), e.dts = Se(e.dts, n), e.pts = Se(e.pts, n), i = e.dts, this.trigger("data", e)) }, this.flush = function () { n = i, this.trigger("done") }, this.endTimeline = function () { this.flush(), this.trigger("endedtimeline") }, this.discontinuity = function () { n = void 0, i = void 0 }, this.reset = function () { this.discontinuity(), this.trigger("reset") } }; ke.prototype = new V; var Ce, Ee = ke, we = function (e, t, i) { var n, r = ""; for (n = t; n < i; n++)r += "%" + ("00" + e[n].toString(16)).slice(-2); return r }, Ae = function (e, t, i) { return decodeURIComponent(we(e, t, i)) }, Pe = function (e) { return e[0] << 21 | e[1] << 14 | e[2] << 7 | e[3] }, Le = { TXXX: function (e) { var t; if (3 === e.data[0]) { for (t = 1; t < e.data.length; t++)if (0 === e.data[t]) { e.description = Ae(e.data, 1, t), e.value = Ae(e.data, t + 1, e.data.length).replace(/\0*$/, ""); break } e.data = e.value } }, WXXX: function (e) { var t; if (3 === e.data[0]) for (t = 1; t < e.data.length; t++)if (0 === e.data[t]) { e.description = Ae(e.data, 1, t), e.url = Ae(e.data, t + 1, e.data.length); break } }, PRIV: function (e) { var t, i; for (t = 0; t < e.data.length; t++)if (0 === e.data[t]) { e.owner = (i = e.data, unescape(we(i, 0, t))); break } e.privateData = e.data.subarray(t + 1), e.data = e.privateData } }; (Ce = function (e) { var t, i = { debug: !(!e || !e.debug), descriptor: e && e.descriptor }, n = 0, r = [], s = 0; if (Ce.prototype.init.call(this), this.dispatchType = be.METADATA_STREAM_TYPE.toString(16), i.descriptor) for (t = 0; t < i.descriptor.length; t++)this.dispatchType += ("00" + i.descriptor[t].toString(16)).slice(-2); this.push = function (e) { var t, a, o, l, u; if ("timed-metadata" === e.type) if (e.dataAlignmentIndicator && (s = 0, r.length = 0), 0 === r.length && (e.data.length < 10 || e.data[0] !== "I".charCodeAt(0) || e.data[1] !== "D".charCodeAt(0) || e.data[2] !== "3".charCodeAt(0))) i.debug && console.log("Skipping unrecognized metadata packet"); else if (r.push(e), s += e.data.byteLength, 1 === r.length && (n = Pe(e.data.subarray(6, 10)), n += 10), !(s < n)) { for (t = { data: new Uint8Array(n), frames: [], pts: r[0].pts, dts: r[0].dts }, u = 0; u < n;)t.data.set(r[0].data.subarray(0, n - u), u), u += r[0].data.byteLength, s -= r[0].data.byteLength, r.shift(); a = 10, 64 & t.data[5] && (a += 4, a += Pe(t.data.subarray(10, 14)), n -= Pe(t.data.subarray(16, 20))); do { if ((o = Pe(t.data.subarray(a + 4, a + 8))) < 1) return console.log("Malformed ID3 frame encountered. Skipping metadata parsing."); if ((l = { id: String.fromCharCode(t.data[a], t.data[a + 1], t.data[a + 2], t.data[a + 3]), data: t.data.subarray(a + 10, a + o + 10) }).key = l.id, Le[l.id] && (Le[l.id](l), "com.apple.streaming.transportStreamTimestamp" === l.owner)) { var c = l.data, d = (1 & c[3]) << 30 | c[4] << 22 | c[5] << 14 | c[6] << 6 | c[7] >>> 2; d *= 4, d += 3 & c[7], l.timeStamp = d, void 0 === t.pts && void 0 === t.dts && (t.pts = l.timeStamp, t.dts = l.timeStamp), this.trigger("timestamp", l) } t.frames.push(l), a += 10, a += o } while (a < n); this.trigger("data", t) } } }).prototype = new V; var Ie, xe, De, Oe = Ce, Re = Ee, Me = 188; (Ie = function () { var e = new Uint8Array(Me), t = 0; Ie.prototype.init.call(this), this.push = function (i) { var n, r = 0, s = Me; for (t ? ((n = new Uint8Array(i.byteLength + t)).set(e.subarray(0, t)), n.set(i, t), t = 0) : n = i; s < n.byteLength;)71 !== n[r] || 71 !== n[s] ? (r++, s++) : (this.trigger("data", n.subarray(r, s)), r += Me, s += Me); r < n.byteLength && (e.set(n.subarray(r), 0), t = n.byteLength - r) }, this.flush = function () { t === Me && 71 === e[0] && (this.trigger("data", e), t = 0), this.trigger("done") }, this.endTimeline = function () { this.flush(), this.trigger("endedtimeline") }, this.reset = function () { t = 0, this.trigger("reset") } }).prototype = new V, (xe = function () { var e, t, i, n; xe.prototype.init.call(this), n = this, this.packetsWaitingForPmt = [], this.programMapTable = void 0, e = function (e, n) { var r = 0; n.payloadUnitStartIndicator && (r += e[r] + 1), "pat" === n.type ? t(e.subarray(r), n) : i(e.subarray(r), n) }, t = function (e, t) { t.section_number = e[7], t.last_section_number = e[8], n.pmtPid = (31 & e[10]) << 8 | e[11], t.pmtPid = n.pmtPid }, i = function (e, t) { var i, r; if (1 & e[5]) { for (n.programMapTable = { video: null, audio: null, "timed-metadata": {} }, i = 3 + ((15 & e[1]) << 8 | e[2]) - 4, r = 12 + ((15 & e[10]) << 8 | e[11]); r < i;) { var s = e[r], a = (31 & e[r + 1]) << 8 | e[r + 2]; s === be.H264_STREAM_TYPE && null === n.programMapTable.video ? n.programMapTable.video = a : s === be.ADTS_STREAM_TYPE && null === n.programMapTable.audio ? n.programMapTable.audio = a : s === be.METADATA_STREAM_TYPE && (n.programMapTable["timed-metadata"][a] = s), r += 5 + ((15 & e[r + 3]) << 8 | e[r + 4]) } t.programMapTable = n.programMapTable } }, this.push = function (t) { var i = {}, n = 4; if (i.payloadUnitStartIndicator = !!(64 & t[1]), i.pid = 31 & t[1], i.pid <<= 8, i.pid |= t[2], (48 & t[3]) >>> 4 > 1 && (n += t[n] + 1), 0 === i.pid) i.type = "pat", e(t.subarray(n), i), this.trigger("data", i); else if (i.pid === this.pmtPid) for (i.type = "pmt", e(t.subarray(n), i), this.trigger("data", i); this.packetsWaitingForPmt.length;)this.processPes_.apply(this, this.packetsWaitingForPmt.shift()); else void 0 === this.programMapTable ? this.packetsWaitingForPmt.push([t, n, i]) : this.processPes_(t, n, i) }, this.processPes_ = function (e, t, i) { i.pid === this.programMapTable.video ? i.streamType = be.H264_STREAM_TYPE : i.pid === this.programMapTable.audio ? i.streamType = be.ADTS_STREAM_TYPE : i.streamType = this.programMapTable["timed-metadata"][i.pid], i.type = "pes", i.data = e.subarray(t), this.trigger("data", i) } }).prototype = new V, xe.STREAM_TYPES = { h264: 27, adts: 15 }, (De = function () { var e, t = this, i = { data: [], size: 0 }, n = { data: [], size: 0 }, r = { data: [], size: 0 }, s = function (e, i, n) { var r, s, a = new Uint8Array(e.size), o = { type: i }, l = 0, u = 0; if (e.data.length && !(e.size < 9)) { for (o.trackId = e.data[0].pid, l = 0; l < e.data.length; l++)s = e.data[l], a.set(s.data, u), u += s.data.byteLength; var c, d, h; c = a, (d = o).packetLength = 6 + (c[4] << 8 | c[5]), d.dataAlignmentIndicator = 0 != (4 & c[6]), 192 & (h = c[7]) && (d.pts = (14 & c[9]) << 27 | (255 & c[10]) << 20 | (254 & c[11]) << 12 | (255 & c[12]) << 5 | (254 & c[13]) >>> 3, d.pts *= 4, d.pts += (6 & c[13]) >>> 1, d.dts = d.pts, 64 & h && (d.dts = (14 & c[14]) << 27 | (255 & c[15]) << 20 | (254 & c[16]) << 12 | (255 & c[17]) << 5 | (254 & c[18]) >>> 3, d.dts *= 4, d.dts += (6 & c[18]) >>> 1)), d.data = c.subarray(9 + c[8]), r = "video" === i || o.packetLength <= e.size, (n || r) && (e.size = 0, e.data.length = 0), r && t.trigger("data", o) } }; De.prototype.init.call(this), this.push = function (a) { ({ pat: function () { }, pes: function () { var e, t; switch (a.streamType) { case be.H264_STREAM_TYPE: e = i, t = "video"; break; case be.ADTS_STREAM_TYPE: e = n, t = "audio"; break; case be.METADATA_STREAM_TYPE: e = r, t = "timed-metadata"; break; default: return }a.payloadUnitStartIndicator && s(e, t, !0), e.data.push(a), e.size += a.data.byteLength }, pmt: function () { var i = { type: "metadata", tracks: [] }; null !== (e = a.programMapTable).video && i.tracks.push({ timelineStartInfo: { baseMediaDecodeTime: 0 }, id: +e.video, codec: "avc", type: "video" }), null !== e.audio && i.tracks.push({ timelineStartInfo: { baseMediaDecodeTime: 0 }, id: +e.audio, codec: "adts", type: "audio" }), t.trigger("data", i) } })[a.type]() }, this.reset = function () { i.size = 0, i.data.length = 0, n.size = 0, n.data.length = 0, this.trigger("reset") }, this.flushStreams_ = function () { s(i, "video"), s(n, "audio"), s(r, "timed-metadata") }, this.flush = function () { this.flushStreams_(), this.trigger("done") } }).prototype = new V; var Ne = { PAT_PID: 0, MP2T_PACKET_LENGTH: Me, TransportPacketStream: Ie, TransportParseStream: xe, ElementaryStream: De, TimestampRolloverStream: Re, CaptionStream: _e.CaptionStream, Cea608Stream: _e.Cea608Stream, MetadataStream: Oe }; for (var Ue in be) be.hasOwnProperty(Ue) && (Ne[Ue] = be[Ue]); var Be, je = Ne, Fe = [96e3, 88200, 64e3, 48e3, 44100, 32e3, 24e3, 22050, 16e3, 12e3, 11025, 8e3, 7350]; (Be = function (e) { var t, i = 0; Be.prototype.init.call(this), this.push = function (n) { var r, s, a, o, l, u, c = 0; if (e || (i = 0), "audio" === n.type) for (t ? (o = t, (t = new Uint8Array(o.byteLength + n.data.byteLength)).set(o), t.set(n.data, o.byteLength)) : t = n.data; c + 5 < t.length;)if (255 === t[c] && 240 == (246 & t[c + 1])) { if (s = 2 * (1 & ~t[c + 1]), r = (3 & t[c + 3]) << 11 | t[c + 4] << 3 | (224 & t[c + 5]) >> 5, u = 9e4 * (l = 1024 * (1 + (3 & t[c + 6]))) / Fe[(60 & t[c + 2]) >>> 2], a = c + r, t.byteLength < a) return; if (this.trigger("data", { pts: n.pts + i * u, dts: n.dts + i * u, sampleCount: l, audioobjecttype: 1 + (t[c + 2] >>> 6 & 3), channelcount: (1 & t[c + 2]) << 2 | (192 & t[c + 3]) >>> 6, samplerate: Fe[(60 & t[c + 2]) >>> 2], samplingfrequencyindex: (60 & t[c + 2]) >>> 2, samplesize: 16, data: t.subarray(c + 7 + s, a) }), i++, t.byteLength === a) return void (t = void 0); t = t.subarray(a) } else c++ }, this.flush = function () { i = 0, this.trigger("done") }, this.reset = function () { t = void 0, this.trigger("reset") }, this.endTimeline = function () { t = void 0, this.trigger("endedtimeline") } }).prototype = new V; var He, Ve, qe, We = Be, ze = function (e) { var t = e.byteLength, i = 0, n = 0; this.length = function () { return 8 * t }, this.bitsAvailable = function () { return 8 * t + n }, this.loadWord = function () { var r = e.byteLength - t, s = new Uint8Array(4), a = Math.min(4, t); if (0 === a) throw new Error("no bytes available"); s.set(e.subarray(r, r + a)), i = new DataView(s.buffer).getUint32(0), n = 8 * a, t -= a }, this.skipBits = function (e) { var r; n > e ? (i <<= e, n -= e) : (e -= n, e -= 8 * (r = Math.floor(e / 8)), t -= r, this.loadWord(), i <<= e, n -= e) }, this.readBits = function (e) { var r = Math.min(n, e), s = i >>> 32 - r; return (n -= r) > 0 ? i <<= r : t > 0 && this.loadWord(), (r = e - r) > 0 ? s << r | this.readBits(r) : s }, this.skipLeadingZeros = function () { var e; for (e = 0; e < n; ++e)if (0 != (i & 2147483648 >>> e)) return i <<= e, n -= e, e; return this.loadWord(), e + this.skipLeadingZeros() }, this.skipUnsignedExpGolomb = function () { this.skipBits(1 + this.skipLeadingZeros()) }, this.skipExpGolomb = function () { this.skipBits(1 + this.skipLeadingZeros()) }, this.readUnsignedExpGolomb = function () { var e = this.skipLeadingZeros(); return this.readBits(e + 1) - 1 }, this.readExpGolomb = function () { var e = this.readUnsignedExpGolomb(); return 1 & e ? 1 + e >>> 1 : -1 * (e >>> 1) }, this.readBoolean = function () { return 1 === this.readBits(1) }, this.readUnsignedByte = function () { return this.readBits(8) }, this.loadWord() }; (Ve = function () { var e, t, i = 0; Ve.prototype.init.call(this), this.push = function (n) { var r; t ? ((r = new Uint8Array(t.byteLength + n.data.byteLength)).set(t), r.set(n.data, t.byteLength), t = r) : t = n.data; for (var s = t.byteLength; i < s - 3; i++)if (1 === t[i + 2]) { e = i + 5; break } for (; e < s;)switch (t[e]) { case 0: if (0 !== t[e - 1]) { e += 2; break } if (0 !== t[e - 2]) { e++; break } i + 3 !== e - 2 && this.trigger("data", t.subarray(i + 3, e - 2)); do { e++ } while (1 !== t[e] && e < s); i = e - 2, e += 3; break; case 1: if (0 !== t[e - 1] || 0 !== t[e - 2]) { e += 3; break } this.trigger("data", t.subarray(i + 3, e - 2)), i = e - 2, e += 3; break; default: e += 3 }t = t.subarray(i), e -= i, i = 0 }, this.reset = function () { t = null, i = 0, this.trigger("reset") }, this.flush = function () { t && t.byteLength > 3 && this.trigger("data", t.subarray(i + 3)), t = null, i = 0, this.trigger("done") }, this.endTimeline = function () { this.flush(), this.trigger("endedtimeline") } }).prototype = new V, qe = { 100: !0, 110: !0, 122: !0, 244: !0, 44: !0, 83: !0, 86: !0, 118: !0, 128: !0, 138: !0, 139: !0, 134: !0 }, (He = function () { var e, t, i, n, r, s, a, o = new Ve; He.prototype.init.call(this), e = this, this.push = function (e) { "video" === e.type && (t = e.trackId, i = e.pts, n = e.dts, o.push(e)) }, o.on("data", (function (a) { var o = { trackId: t, pts: i, dts: n, data: a }; switch (31 & a[0]) { case 5: o.nalUnitType = "slice_layer_without_partitioning_rbsp_idr"; break; case 6: o.nalUnitType = "sei_rbsp", o.escapedRBSP = r(a.subarray(1)); break; case 7: o.nalUnitType = "seq_parameter_set_rbsp", o.escapedRBSP = r(a.subarray(1)), o.config = s(o.escapedRBSP); break; case 8: o.nalUnitType = "pic_parameter_set_rbsp"; break; case 9: o.nalUnitType = "access_unit_delimiter_rbsp" }e.trigger("data", o) })), o.on("done", (function () { e.trigger("done") })), o.on("partialdone", (function () { e.trigger("partialdone") })), o.on("reset", (function () { e.trigger("reset") })), o.on("endedtimeline", (function () { e.trigger("endedtimeline") })), this.flush = function () { o.flush() }, this.partialFlush = function () { o.partialFlush() }, this.reset = function () { o.reset() }, this.endTimeline = function () { o.endTimeline() }, a = function (e, t) { var i, n = 8, r = 8; for (i = 0; i < e; i++)0 !== r && (r = (n + t.readExpGolomb() + 256) % 256), n = 0 === r ? n : r }, r = function (e) { for (var t, i, n = e.byteLength, r = [], s = 1; s < n - 2;)0 === e[s] && 0 === e[s + 1] && 3 === e[s + 2] ? (r.push(s + 2), s += 2) : s++; if (0 === r.length) return e; t = n - r.length, i = new Uint8Array(t); var a = 0; for (s = 0; s < t; a++, s++)a === r[0] && (a++, r.shift()), i[s] = e[a]; return i }, s = function (e) { var t, i, n, r, s, o, l, u, c, d, h, p, f, m = 0, g = 0, v = 0, y = 0, _ = 1; if (i = (t = new ze(e)).readUnsignedByte(), r = t.readUnsignedByte(), n = t.readUnsignedByte(), t.skipUnsignedExpGolomb(), qe[i] && (3 === (s = t.readUnsignedExpGolomb()) && t.skipBits(1), t.skipUnsignedExpGolomb(), t.skipUnsignedExpGolomb(), t.skipBits(1), t.readBoolean())) for (h = 3 !== s ? 8 : 12, f = 0; f < h; f++)t.readBoolean() && a(f < 6 ? 16 : 64, t); if (t.skipUnsignedExpGolomb(), 0 === (o = t.readUnsignedExpGolomb())) t.readUnsignedExpGolomb(); else if (1 === o) for (t.skipBits(1), t.skipExpGolomb(), t.skipExpGolomb(), l = t.readUnsignedExpGolomb(), f = 0; f < l; f++)t.skipExpGolomb(); if (t.skipUnsignedExpGolomb(), t.skipBits(1), u = t.readUnsignedExpGolomb(), c = t.readUnsignedExpGolomb(), 0 === (d = t.readBits(1)) && t.skipBits(1), t.skipBits(1), t.readBoolean() && (m = t.readUnsignedExpGolomb(), g = t.readUnsignedExpGolomb(), v = t.readUnsignedExpGolomb(), y = t.readUnsignedExpGolomb()), t.readBoolean() && t.readBoolean()) { switch (t.readUnsignedByte()) { case 1: p = [1, 1]; break; case 2: p = [12, 11]; break; case 3: p = [10, 11]; break; case 4: p = [16, 11]; break; case 5: p = [40, 33]; break; case 6: p = [24, 11]; break; case 7: p = [20, 11]; break; case 8: p = [32, 11]; break; case 9: p = [80, 33]; break; case 10: p = [18, 11]; break; case 11: p = [15, 11]; break; case 12: p = [64, 33]; break; case 13: p = [160, 99]; break; case 14: p = [4, 3]; break; case 15: p = [3, 2]; break; case 16: p = [2, 1]; break; case 255: p = [t.readUnsignedByte() << 8 | t.readUnsignedByte(), t.readUnsignedByte() << 8 | t.readUnsignedByte()] }p && (_ = p[0] / p[1]) } return { profileIdc: i, levelIdc: n, profileCompatibility: r, width: Math.ceil((16 * (u + 1) - 2 * m - 2 * g) * _), height: (2 - d) * (c + 1) * 16 - 2 * v - 2 * y, sarRatio: p } } }).prototype = new V; var Ge, Xe = { H264Stream: He, NalByteStream: Ve }, Ke = function (e, t) { var i = e[t + 6] << 21 | e[t + 7] << 14 | e[t + 8] << 7 | e[t + 9]; return (16 & e[t + 5]) >> 4 ? i + 20 : i + 10 }, Ye = function (e, t) { var i = (224 & e[t + 5]) >> 5, n = e[t + 4] << 3; return 6144 & e[t + 3] | n | i }; (Ge = function () { var e = new Uint8Array, t = 0; Ge.prototype.init.call(this), this.setTimestamp = function (e) { t = e }, this.push = function (i) { var n, r, s, a, o = 0, l = 0; for (e.length ? (a = e.length, (e = new Uint8Array(i.byteLength + a)).set(e.subarray(0, a)), e.set(i, a)) : e = i; e.length - l >= 3;)if (e[l] !== "I".charCodeAt(0) || e[l + 1] !== "D".charCodeAt(0) || e[l + 2] !== "3".charCodeAt(0)) if (255 != (255 & e[l]) || 240 != (240 & e[l + 1])) l++; else { if (e.length - l < 7) break; if (l + (o = Ye(e, l)) > e.length) break; s = { type: "audio", data: e.subarray(l, l + o), pts: t, dts: t }, this.trigger("data", s), l += o } else { if (e.length - l < 10) break; if (l + (o = Ke(e, l)) > e.length) break; r = { type: "timed-metadata", data: e.subarray(l, l + o) }, this.trigger("data", r), l += o } n = e.length - l, e = n > 0 ? e.subarray(l) : new Uint8Array }, this.reset = function () { e = new Uint8Array, this.trigger("reset") }, this.endTimeline = function () { e = new Uint8Array, this.trigger("endedtimeline") } }).prototype = new V; var $e, Qe, Je, Ze, et = Ge, tt = ["audioobjecttype", "channelcount", "samplerate", "samplingfrequencyindex", "samplesize"], it = ["width", "height", "profileIdc", "levelIdc", "profileCompatibility", "sarRatio"], nt = Xe.H264Stream, rt = function (e) { return e[0] === "I".charCodeAt(0) && e[1] === "D".charCodeAt(0) && e[2] === "3".charCodeAt(0) }, st = function (e, t) { var i; if (e.length !== t.length) return !1; for (i = 0; i < e.length; i++)if (e[i] !== t[i]) return !1; return !0 }, at = function (e, t, i, n, r, s) { return { start: { dts: e, pts: e + (i - t) }, end: { dts: e + (n - t), pts: e + (r - i) }, prependedContentDuration: s, baseMediaDecodeTime: e } }; (Qe = function (e, t) { var i = [], n = 0, r = 0, s = 0, a = 1 / 0; t = t || {}, Qe.prototype.init.call(this), this.push = function (t) { he(e, t), e && tt.forEach((function (i) { e[i] = t[i] })), i.push(t) }, this.setEarliestDts = function (e) { r = e }, this.setVideoBaseMediaDecodeTime = function (e) { a = e }, this.setAudioAppendStart = function (e) { s = e }, this.flush = function () { var o, l, u, c, d; 0 !== i.length ? (o = function (e, t, i) { return t.minSegmentDts >= i ? e : (t.minSegmentDts = 1 / 0, e.filter((function (e) { return e.dts >= i && (t.minSegmentDts = Math.min(t.minSegmentDts, e.dts), t.minSegmentPts = t.minSegmentDts, !0) }))) }(i, e, r), e.baseMediaDecodeTime = de(e, t.keepOriginalTimestamps), ue(e, o, s, a), e.samples = function (e) { var t, i, n = []; for (t = 0; t < e.length; t++)i = e[t], n.push({ size: i.data.byteLength, duration: 1024 }); return n }(o), u = J(function (e) { var t, i, n = 0, r = new Uint8Array(function (e) { var t, i = 0; for (t = 0; t < e.length; t++)i += e[t].data.byteLength; return i }(e)); for (t = 0; t < e.length; t++)i = e[t], r.set(i.data, n), n += i.data.byteLength; return r }(o)), i = [], l = Z(n, [e]), c = new Uint8Array(l.byteLength + u.byteLength), n++, c.set(l), c.set(u, l.byteLength), ce(e), d = Math.ceil(9216e4 / e.samplerate), o.length && this.trigger("timingInfo", { start: o[0].pts, end: o[0].pts + o.length * d }), this.trigger("data", { track: e, boxes: c }), this.trigger("done", "AudioSegmentStream")) : this.trigger("done", "AudioSegmentStream") }, this.reset = function () { ce(e), i = [], this.trigger("reset") } }).prototype = new V, ($e = function (e, t) { var i, n, r = 0, s = [], a = []; t = t || {}, $e.prototype.init.call(this), delete e.minPTS, this.gopCache_ = [], this.push = function (t) { he(e, t), "seq_parameter_set_rbsp" !== t.nalUnitType || i || (i = t.config, e.sps = [t.data], it.forEach((function (t) { e[t] = i[t] }), this)), "pic_parameter_set_rbsp" !== t.nalUnitType || n || (n = t.data, e.pps = [t.data]), s.push(t) }, this.flush = function () { for (var i, n, o, l, u, c, d, h = 0; s.length && "access_unit_delimiter_rbsp" !== s[0].nalUnitType;)s.shift(); if (0 === s.length) return this.resetStream_(), void this.trigger("done", "VideoSegmentStream"); if ((n = function (e) { var t, i, n = [], r = []; for (n.byteLength = 0, n.nalCount = 0, n.duration = 0, n.pts = e[0].pts, n.dts = e[0].dts, r.byteLength = 0, r.nalCount = 0, r.duration = 0, r.pts = e[0].pts, r.dts = e[0].dts, t = 0; t < e.length; t++)(i = e[t]).keyFrame ? (n.length && (r.push(n), r.byteLength += n.byteLength, r.nalCount += n.nalCount, r.duration += n.duration), (n = [i]).nalCount = i.length, n.byteLength = i.byteLength, n.pts = i.pts, n.dts = i.dts, n.duration = i.duration) : (n.duration += i.duration, n.nalCount += i.length, n.byteLength += i.byteLength, n.push(i)); return r.length && n.duration <= 0 && (n.duration = r[r.length - 1].duration), r.byteLength += n.byteLength, r.nalCount += n.nalCount, r.duration += n.duration, r.push(n), r }(function (e) { var t, i, n = [], r = []; for (r.byteLength = 0, r.nalCount = 0, r.duration = 0, n.byteLength = 0, t = 0; t < e.length; t++)"access_unit_delimiter_rbsp" === (i = e[t]).nalUnitType ? (n.length && (n.duration = i.dts - n.dts, r.byteLength += n.byteLength, r.nalCount += n.length, r.duration += n.duration, r.push(n)), (n = [i]).byteLength = i.data.byteLength, n.pts = i.pts, n.dts = i.dts) : ("slice_layer_without_partitioning_rbsp_idr" === i.nalUnitType && (n.keyFrame = !0), n.duration = i.dts - n.dts, n.byteLength += i.data.byteLength, n.push(i)); return r.length && (!n.duration || n.duration <= 0) && (n.duration = r[r.length - 1].duration), r.byteLength += n.byteLength, r.nalCount += n.length, r.duration += n.duration, r.push(n), r }(s)))[0][0].keyFrame || ((i = this.getGopForFusion_(s[0], e)) ? (h = i.duration, n.unshift(i), n.byteLength += i.byteLength, n.nalCount += i.nalCount, n.pts = i.pts, n.dts = i.dts, n.duration += i.duration) : n = function (e) { var t; return !e[0][0].keyFrame && e.length > 1 && (t = e.shift(), e.byteLength -= t.byteLength, e.nalCount -= t.nalCount, e[0][0].dts = t.dts, e[0][0].pts = t.pts, e[0][0].duration += t.duration), e }(n)), a.length) { var p; if (!(p = t.alignGopsAtEnd ? this.alignGopsAtEnd_(n) : this.alignGopsAtStart_(n))) return this.gopCache_.unshift({ gop: n.pop(), pps: e.pps, sps: e.sps }), this.gopCache_.length = Math.min(6, this.gopCache_.length), s = [], this.resetStream_(), void this.trigger("done", "VideoSegmentStream"); ce(e), n = p } he(e, n), e.samples = function (e, t) { var i, n, r, s, a, o = t || 0, l = []; for (i = 0; i < e.length; i++)for (s = e[i], n = 0; n < s.length; n++)a = s[n], o += (r = ee(a, o)).size, l.push(r); return l }(n), l = J(function (e) { var t, i, n, r, s, a, o = 0, l = e.byteLength, u = e.nalCount, c = new Uint8Array(l + 4 * u), d = new DataView(c.buffer); for (t = 0; t < e.length; t++)for (r = e[t], i = 0; i < r.length; i++)for (s = r[i], n = 0; n < s.length; n++)a = s[n], d.setUint32(o, a.data.byteLength), o += 4, c.set(a.data, o), o += a.data.byteLength; return c }(n)), e.baseMediaDecodeTime = de(e, t.keepOriginalTimestamps), this.trigger("processedGopsInfo", n.map((function (e) { return { pts: e.pts, dts: e.dts, byteLength: e.byteLength } }))), c = n[0], d = n[n.length - 1], this.trigger("segmentTimingInfo", at(e.baseMediaDecodeTime, c.dts, c.pts, d.dts + d.duration, d.pts + d.duration, h)), this.trigger("timingInfo", { start: n[0].pts, end: n[n.length - 1].pts + n[n.length - 1].duration }), this.gopCache_.unshift({ gop: n.pop(), pps: e.pps, sps: e.sps }), this.gopCache_.length = Math.min(6, this.gopCache_.length), s = [], this.trigger("baseMediaDecodeTime", e.baseMediaDecodeTime), this.trigger("timelineStartInfo", e.timelineStartInfo), o = Z(r, [e]), u = new Uint8Array(o.byteLength + l.byteLength), r++, u.set(o), u.set(l, o.byteLength), this.trigger("data", { track: e, boxes: u }), this.resetStream_(), this.trigger("done", "VideoSegmentStream") }, this.reset = function () { this.resetStream_(), s = [], this.gopCache_.length = 0, a.length = 0, this.trigger("reset") }, this.resetStream_ = function () { ce(e), i = void 0, n = void 0 }, this.getGopForFusion_ = function (t) { var i, n, r, s, a, o = 1 / 0; for (a = 0; a < this.gopCache_.length; a++)r = (s = this.gopCache_[a]).gop, e.pps && st(e.pps[0], s.pps[0]) && e.sps && st(e.sps[0], s.sps[0]) && (r.dts < e.timelineStartInfo.dts || (i = t.dts - r.dts - r.duration) >= -1e4 && i <= 45e3 && (!n || o > i) && (n = s, o = i)); return n ? n.gop : null }, this.alignGopsAtStart_ = function (e) { var t, i, n, r, s, o, l, u; for (s = e.byteLength, o = e.nalCount, l = e.duration, t = i = 0; t < a.length && i < e.length && (n = a[t], r = e[i], n.pts !== r.pts);)r.pts > n.pts ? t++ : (i++, s -= r.byteLength, o -= r.nalCount, l -= r.duration); return 0 === i ? e : i === e.length ? null : ((u = e.slice(i)).byteLength = s, u.duration = l, u.nalCount = o, u.pts = u[0].pts, u.dts = u[0].dts, u) }, this.alignGopsAtEnd_ = function (e) { var t, i, n, r, s, o, l; for (t = a.length - 1, i = e.length - 1, s = null, o = !1; t >= 0 && i >= 0;) { if (n = a[t], r = e[i], n.pts === r.pts) { o = !0; break } n.pts > r.pts ? t-- : (t === a.length - 1 && (s = i), i--) } if (!o && null === s) return null; if (0 === (l = o ? i : s)) return e; var u = e.slice(l), c = u.reduce((function (e, t) { return e.byteLength += t.byteLength, e.duration += t.duration, e.nalCount += t.nalCount, e }), { byteLength: 0, duration: 0, nalCount: 0 }); return u.byteLength = c.byteLength, u.duration = c.duration, u.nalCount = c.nalCount, u.pts = u[0].pts, u.dts = u[0].dts, u }, this.alignGopsWith = function (e) { a = e } }).prototype = new V, (Ze = function (e, t) { this.numberOfTracks = 0, this.metadataStream = t, void 0 !== (e = e || {}).remux ? this.remuxTracks = !!e.remux : this.remuxTracks = !0, "boolean" == typeof e.keepOriginalTimestamps ? this.keepOriginalTimestamps = e.keepOriginalTimestamps : this.keepOriginalTimestamps = !1, this.pendingTracks = [], this.videoTrack = null, this.pendingBoxes = [], this.pendingCaptions = [], this.pendingMetadata = [], this.pendingBytes = 0, this.emittedTracks = 0, Ze.prototype.init.call(this), this.push = function (e) { return e.text ? this.pendingCaptions.push(e) : e.frames ? this.pendingMetadata.push(e) : (this.pendingTracks.push(e.track), this.pendingBytes += e.boxes.byteLength, "video" === e.track.type && (this.videoTrack = e.track, this.pendingBoxes.push(e.boxes)), void ("audio" === e.track.type && (this.audioTrack = e.track, this.pendingBoxes.unshift(e.boxes)))) } }).prototype = new V, Ze.prototype.flush = function (e) { var t, i, n, r, a = 0, o = { captions: [], captionStreams: {}, metadata: [], info: {} }, l = 0; if (this.pendingTracks.length < this.numberOfTracks) { if ("VideoSegmentStream" !== e && "AudioSegmentStream" !== e) return; if (this.remuxTracks) return; if (0 === this.pendingTracks.length) return this.emittedTracks++, void (this.emittedTracks >= this.numberOfTracks && (this.trigger("done"), this.emittedTracks = 0)) } if (this.videoTrack ? (l = this.videoTrack.timelineStartInfo.pts, it.forEach((function (e) { o.info[e] = this.videoTrack[e] }), this)) : this.audioTrack && (l = this.audioTrack.timelineStartInfo.pts, tt.forEach((function (e) { o.info[e] = this.audioTrack[e] }), this)), this.videoTrack || this.audioTrack) { for (1 === this.pendingTracks.length ? o.type = this.pendingTracks[0].type : o.type = "combined", this.emittedTracks += this.pendingTracks.length, n = function (e) { var t, i = s(), n = u(e); return (t = new Uint8Array(i.byteLength + n.byteLength)).set(i), t.set(n, i.byteLength), t }(this.pendingTracks), o.initSegment = new Uint8Array(n.byteLength), o.initSegment.set(n), o.data = new Uint8Array(this.pendingBytes), r = 0; r < this.pendingBoxes.length; r++)o.data.set(this.pendingBoxes[r], a), a += this.pendingBoxes[r].byteLength; for (r = 0; r < this.pendingCaptions.length; r++)(t = this.pendingCaptions[r]).startTime = le(t.startPts, l, this.keepOriginalTimestamps), t.endTime = le(t.endPts, l, this.keepOriginalTimestamps), o.captionStreams[t.stream] = !0, o.captions.push(t); for (r = 0; r < this.pendingMetadata.length; r++)(i = this.pendingMetadata[r]).cueTime = le(i.pts, l, this.keepOriginalTimestamps), o.metadata.push(i); for (o.metadata.dispatchType = this.metadataStream.dispatchType, this.pendingTracks.length = 0, this.videoTrack = null, this.pendingBoxes.length = 0, this.pendingCaptions.length = 0, this.pendingBytes = 0, this.pendingMetadata.length = 0, this.trigger("data", o), r = 0; r < o.captions.length; r++)t = o.captions[r], this.trigger("caption", t); for (r = 0; r < o.metadata.length; r++)i = o.metadata[r], this.trigger("id3Frame", i) } this.emittedTracks >= this.numberOfTracks && (this.trigger("done"), this.emittedTracks = 0) }, Ze.prototype.setRemux = function (e) { this.remuxTracks = e }, (Je = function (e) { var t, i, n = this, r = !0; Je.prototype.init.call(this), e = e || {}, this.baseMediaDecodeTime = e.baseMediaDecodeTime || 0, this.transmuxPipeline_ = {}, this.setupAacPipeline = function () { var r = {}; this.transmuxPipeline_ = r, r.type = "aac", r.metadataStream = new je.MetadataStream, r.aacStream = new et, r.audioTimestampRolloverStream = new je.TimestampRolloverStream("audio"), r.timedMetadataTimestampRolloverStream = new je.TimestampRolloverStream("timed-metadata"), r.adtsStream = new We, r.coalesceStream = new Ze(e, r.metadataStream), r.headOfPipeline = r.aacStream, r.aacStream.pipe(r.audioTimestampRolloverStream).pipe(r.adtsStream), r.aacStream.pipe(r.timedMetadataTimestampRolloverStream).pipe(r.metadataStream).pipe(r.coalesceStream), r.metadataStream.on("timestamp", (function (e) { r.aacStream.setTimestamp(e.timeStamp) })), r.aacStream.on("data", (function (s) { "timed-metadata" !== s.type || r.audioSegmentStream || (i = i || { timelineStartInfo: { baseMediaDecodeTime: n.baseMediaDecodeTime }, codec: "adts", type: "audio" }, r.coalesceStream.numberOfTracks++, r.audioSegmentStream = new Qe(i, e), r.audioSegmentStream.on("timingInfo", n.trigger.bind(n, "audioTimingInfo")), r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream)), n.trigger("trackinfo", { hasAudio: !!i, hasVideo: !!t }) })), r.coalesceStream.on("data", this.trigger.bind(this, "data")), r.coalesceStream.on("done", this.trigger.bind(this, "done")) }, this.setupTsPipeline = function () { var r = {}; this.transmuxPipeline_ = r, r.type = "ts", r.metadataStream = new je.MetadataStream, r.packetStream = new je.TransportPacketStream, r.parseStream = new je.TransportParseStream, r.elementaryStream = new je.ElementaryStream, r.timestampRolloverStream = new je.TimestampRolloverStream, r.adtsStream = new We, r.h264Stream = new nt, r.captionStream = new je.CaptionStream, r.coalesceStream = new Ze(e, r.metadataStream), r.headOfPipeline = r.packetStream, r.packetStream.pipe(r.parseStream).pipe(r.elementaryStream).pipe(r.timestampRolloverStream), r.timestampRolloverStream.pipe(r.h264Stream), r.timestampRolloverStream.pipe(r.adtsStream), r.timestampRolloverStream.pipe(r.metadataStream).pipe(r.coalesceStream), r.h264Stream.pipe(r.captionStream).pipe(r.coalesceStream), r.elementaryStream.on("data", (function (s) { var a, o = e.keepOriginalTimestamps ? 0 : n.baseMediaDecodeTime; if ("metadata" === s.type) { for (a = s.tracks.length; a--;)t || "video" !== s.tracks[a].type ? i || "audio" !== s.tracks[a].type || ((i = s.tracks[a]).timelineStartInfo.baseMediaDecodeTime = o) : (t = s.tracks[a]).timelineStartInfo.baseMediaDecodeTime = o; t && !r.videoSegmentStream && (r.coalesceStream.numberOfTracks++, r.videoSegmentStream = new $e(t, e), r.videoSegmentStream.on("timelineStartInfo", (function (t) { i && !e.keepOriginalTimestamps && (i.timelineStartInfo = t, r.audioSegmentStream.setEarliestDts(t.dts - n.baseMediaDecodeTime)) })), r.videoSegmentStream.on("processedGopsInfo", n.trigger.bind(n, "gopInfo")), r.videoSegmentStream.on("segmentTimingInfo", n.trigger.bind(n, "videoSegmentTimingInfo")), r.videoSegmentStream.on("baseMediaDecodeTime", (function (e) { i && r.audioSegmentStream.setVideoBaseMediaDecodeTime(e) })), r.videoSegmentStream.on("timingInfo", n.trigger.bind(n, "videoTimingInfo")), r.h264Stream.pipe(r.videoSegmentStream).pipe(r.coalesceStream)), i && !r.audioSegmentStream && (r.coalesceStream.numberOfTracks++, r.audioSegmentStream = new Qe(i, e), r.audioSegmentStream.on("timingInfo", n.trigger.bind(n, "audioTimingInfo")), r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream)), n.trigger("trackinfo", { hasAudio: !!i, hasVideo: !!t }) } })), r.coalesceStream.on("data", this.trigger.bind(this, "data")), r.coalesceStream.on("id3Frame", (function (e) { e.dispatchType = r.metadataStream.dispatchType, n.trigger("id3Frame", e) })), r.coalesceStream.on("caption", this.trigger.bind(this, "caption")), r.coalesceStream.on("done", this.trigger.bind(this, "done")) }, this.setBaseMediaDecodeTime = function (e) { var n = this.transmuxPipeline_; this.baseMediaDecodeTime = e, i && (i.timelineStartInfo.dts = void 0, i.timelineStartInfo.pts = void 0, ce(i), n.audioTimestampRolloverStream && n.audioTimestampRolloverStream.discontinuity()), t && (n.videoSegmentStream && (n.videoSegmentStream.gopCache_ = []), t.timelineStartInfo.dts = void 0, t.timelineStartInfo.pts = void 0, ce(t), n.captionStream.reset()), n.timestampRolloverStream && n.timestampRolloverStream.discontinuity() }, this.setAudioAppendStart = function (e) { i && this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e) }, this.setRemux = function (t) { var i = this.transmuxPipeline_; e.remux = t, i && i.coalesceStream && i.coalesceStream.setRemux(t) }, this.alignGopsWith = function (e) { t && this.transmuxPipeline_.videoSegmentStream && this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e) }, this.push = function (e) { if (r) { var t = rt(e); t && "aac" !== this.transmuxPipeline_.type ? this.setupAacPipeline() : t || "ts" === this.transmuxPipeline_.type || this.setupTsPipeline(), r = !1 } this.transmuxPipeline_.headOfPipeline.push(e) }, this.flush = function () { r = !0, this.transmuxPipeline_.headOfPipeline.flush() }, this.endTimeline = function () { this.transmuxPipeline_.headOfPipeline.endTimeline() }, this.reset = function () { this.transmuxPipeline_.headOfPipeline && this.transmuxPipeline_.headOfPipeline.reset() }, this.resetCaptions = function () { this.transmuxPipeline_.captionStream && this.transmuxPipeline_.captionStream.reset() } }).prototype = new V; var ot = { Transmuxer: Je, VideoSegmentStream: $e, AudioSegmentStream: Qe, AUDIO_PROPERTIES: tt, VIDEO_PROPERTIES: it, generateVideoSegmentTimingInfo: at }, lt = function () { function e(e, t) { for (var i = 0; i < t.length; i++) { var n = t[i]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (t, i, n) { return i && e(t.prototype, i), n && e(t, n), t } }(), ut = function () { function e(t, i) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.options = i || {}, this.self = t, this.init() } return lt(e, [{ key: "init", value: function () { this.transmuxer && this.transmuxer.dispose(), this.transmuxer = new ot.Transmuxer(this.options), function (e, t) { t.on("data", (function (t) { var i = t.initSegment; t.initSegment = { data: i.buffer, byteOffset: i.byteOffset, byteLength: i.byteLength }; var n = t.data; t.data = n.buffer, e.postMessage({ action: "data", segment: t, byteOffset: n.byteOffset, byteLength: n.byteLength }, [t.data]) })), t.captionStream && t.captionStream.on("data", (function (t) { e.postMessage({ action: "caption", data: t }) })), t.on("done", (function (t) { e.postMessage({ action: "done" }) })), t.on("gopInfo", (function (t) { e.postMessage({ action: "gopInfo", gopInfo: t }) })), t.on("videoSegmentTimingInfo", (function (t) { e.postMessage({ action: "videoSegmentTimingInfo", videoSegmentTimingInfo: t }) })) }(this.self, this.transmuxer) } }, { key: "push", value: function (e) { var t = new Uint8Array(e.data, e.byteOffset, e.byteLength); this.transmuxer.push(t) } }, { key: "reset", value: function () { this.init() } }, { key: "setTimestampOffset", value: function (e) { var t = e.timestampOffset || 0; this.transmuxer.setBaseMediaDecodeTime(Math.round(9e4 * t)) } }, { key: "setAudioAppendStart", value: function (e) { this.transmuxer.setAudioAppendStart(Math.ceil(9e4 * e.appendStart)) } }, { key: "flush", value: function (e) { this.transmuxer.flush() } }, { key: "resetCaptions", value: function () { this.transmuxer.resetCaptions() } }, { key: "alignGopsWith", value: function (e) { this.transmuxer.alignGopsWith(e.gopsToAlignWith.slice()) } }]), e }(); new function (e) { e.onmessage = function (t) { "init" === t.data.action && t.data.options ? this.messageHandlers = new ut(e, t.data.options) : (this.messageHandlers || (this.messageHandlers = new ut(e)), t.data && t.data.action && "init" !== t.data.action && this.messageHandlers[t.data.action] && this.messageHandlers[t.data.action](t.data)) } }(i) }()